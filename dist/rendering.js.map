{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","panel","events","on","render","console","log","histData","length","items","renderHist2","data","x","y","type","Plotly","newPlot","renderHist","values","map","d","formatCount","d3","format","color","margin","top","right","bottom","left","width","height","max","min","scaleLinear","domain","range","histogram","thresholds","ticks","yMax","yMin","colorScale","rgb","brighter","darker","xAxis","axisBottom","svg","select","append","attr","bar","selectAll","enter","x0","x1","text","call","$"],"mappings":"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","file":"rendering.js","sourcesContent":["import $ from 'jquery';\nimport * as d3 from \"d3\";\nimport Plotly from 'plotly.js-dist';\n\nexport default function link(scope, elem, attrs, ctrl) {\n    const panel = ctrl.panel;\n\n    ctrl.events.on('render', function () {\n        render();\n    });\n\n    function render() {\n        console.log(panel);\n        if (panel.histData.length > 0 && panel.histData[0].items.length > 0) {\n            renderHist2();\n        }\n    }\n\n    function renderHist2() {\n        var data = [\n            {\n                x: ['giraffes', 'orangutans', 'monkeys'],\n                y: [20, 14, 23],\n                type: 'bar'\n            }\n        ];\n\n        Plotly.newPlot('panel-plugin-test-clock-plugin.panel-height-helper ng-transclude.panel-height-helper', data);\n    }\n\n    function renderHist() {\n        // const xData = data.items.map(d => d.x);\n        const values = panel.histData[0].items.map(d => d.y);\n        var formatCount = d3.format(\",.0f\");\n        var color = \"steelblue\";\n        var margin = {top: 10, right: 30, bottom: 30, left: 30},\n            width = 960 - margin.left - margin.right,\n            height = 500 - margin.top - margin.bottom;\n\n        var max = d3.max(values);\n        var min = d3.min(values);\n        var x = d3.scaleLinear()\n            .domain([min, max])\n            .range([0, width]);\n\n        var data = d3.histogram()\n            .thresholds(x.ticks(values.length))\n            (values);\n\n        console.log(x);\n        console.log(data);\n        var yMax = d3.max(data, function(d){return d.length});\n        var yMin = d3.min(data, function(d){return d.length});\n        var colorScale = d3.scaleLinear()\n            .domain([yMin, yMax])\n            .range([d3.rgb(color).brighter(), d3.rgb(color).darker()]);\n\n        console.log(yMax);\n        console.log(yMin);\n\n        var y = d3.scaleLinear()\n            .range([height, 0]);\n\n        console.log(y);\n        console.log(y(30));\n        var xAxis = d3.axisBottom(x);\n\n        var svg = d3.select(\"panel-plugin-test-clock-plugin.panel-height-helper ng-transclude.panel-height-helper\").append(\"svg\")\n            .attr(\"width\", width + margin.left + margin.right)\n            .attr(\"height\", height + margin.top + margin.bottom)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n        var bar = svg.selectAll(\".bar\")\n            .data(data)\n            .enter().append(\"g\")\n            .attr(\"class\", \"bar\")\n            .attr(\"transform\", function(d) { return \"translate(\" + x(d.x0) + \",\" + y(d[0]) + \")\"; });\n\n        bar.append(\"rect\")\n            .attr(\"x\", 1)\n            .attr(\"width\", function(d) { return x(d.x1) - x(d.x0) - 1; })\n            .attr(\"height\", function(d) { return height - y(d[0]); })\n            .attr(\"fill\", function(d) { return colorScale(d[0]) });\n\n        bar.append(\"text\")\n            .attr(\"dy\", \".75em\")\n            .attr(\"y\", -12)\n            .attr(\"x\", function(d) { return (x(d.x1) - x(d.x0)) / 2; })\n            .attr(\"text-anchor\", \"middle\")\n            .text(function(d) { return formatCount(d[0]); });\n\n        svg.append(\"g\")\n            .attr(\"class\", \"x axis\")\n            .attr(\"transform\", \"translate(0,\" + height + \")\")\n            .call(xAxis);\n\n    }\n\n}\n"]}