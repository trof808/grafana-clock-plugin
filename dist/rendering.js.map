{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","panel","events","on","render","console","log","histData","length","items","renderHist2","container","find","$tooltip","$","appendChild","ctx","document","getElementById","getContext","myBarChart","Chart","type","data","options","scales","yAxes","ticks","beginAtZero","renderHist","xData","map","d","x","yData","y","margin","top","right","bottom","left","width","height","d3","scaleTime","domain","rangeRound","scaleLinear","range","histogram","value","format","thresholds","timeWeek","svg","select","append","attr","call","axisBottom","bins","max","bar","selectAll","enter","x0","x1","text","formatCount","date","parseDate"],"mappings":"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","file":"rendering.js","sourcesContent":["import $ from 'jquery';\nimport * as d3 from \"d3\";\nimport Chart from 'chart.js';\n\nexport default function link(scope, elem, attrs, ctrl) {\n    const panel = ctrl.panel;\n\n    ctrl.events.on('render', function () {\n        render();\n    });\n\n    function render() {\n        console.log(panel);\n        if (panel.histData.length > 0 && panel.histData[0].items.length > 0) {\n            renderHist2();\n        }\n    }\n\n    function renderHist2() {\n        const container = elem.find('div.panel-content > .panel-height-helper');\n        var $tooltip = $('<canvas id=\"myChart\" width=\"400\" height=\"400\"></canvas>');\n        container.appendChild($tooltip);\n        var ctx = document.getElementById('myChart').getContext('2d');\n        var myBarChart = new Chart(ctx, {\n            type: 'bar',\n            data: panel.histData[0].items,\n            options: {\n                scales: {\n                    yAxes: [{\n                        ticks: {\n                            beginAtZero: true\n                        }\n                    }]\n                }\n            }\n        });\n        myBarChart.render();\n    }\n\n    function renderHist() {\n        const data = panel.histData[0];\n        const xData = data.items.map(d => d.x);\n        const yData = data.items.map(d => d.y);\n        console.log(xData);\n        console.log(yData);\n        var margin = {top: 10, right: 30, bottom: 30, left: 30},\n            width = 960 - margin.left - margin.right,\n            height = 500 - margin.top - margin.bottom;\n\n        var x = d3.scaleTime()\n            .domain([xData[0], xData[xData.length - 1]])\n            .rangeRound([0, width]);\n        console.log(x);\n\n        var y = d3.scaleLinear()\n            .range([height, 0]);\n\n        var histogram = d3.histogram()\n            .value(function(d) { return d.format(\"DD-MM-YYYY\"); })\n            .domain(x.domain())\n            .thresholds(x.ticks(d3.timeWeek));\n\n        var svg = d3.select(\"div.panel-content > .panel-height-helper\").append(\"svg\")\n            .attr(\"width\", width + margin.left + margin.right)\n            .attr(\"height\", height + margin.top + margin.bottom)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n        svg.append(\"g\")\n            .attr(\"class\", \"axis axis--x\")\n            .attr(\"transform\", \"translate(0,\" + height + \")\")\n            .call(d3.axisBottom(x));\n\n        var bins = histogram(xData);\n\n        y.domain([0, d3.max(yData)]);\n\n        console.log(bins);\n\n        var bar = svg.selectAll(\".bar\")\n            .data(bins)\n            .enter().append(\"g\")\n            .attr(\"class\", \"bar\")\n            .attr(\"transform\", function(d) { return \"translate(\" + x(d.x0) + \",\" + y(d.length) + \")\"; });\n\n        bar.append(\"rect\")\n            .attr(\"x\", 1)\n            .attr(\"width\", function(d) { return x(d.x1) - x(d.x0) - 1; })\n            .attr(\"height\", function(d) { return height - y(d.length); });\n\n        bar.append(\"text\")\n            .attr(\"dy\", \".75em\")\n            .attr(\"y\", 6)\n            .attr(\"x\", function(d) { return (x(d.x1) - x(d.x0)) / 2; })\n            .attr(\"text-anchor\", \"middle\")\n            .text(function(d) { return formatCount(d.length); });\n\n        function type(d) {\n            d.date = parseDate(d.date);\n            return d;\n        }\n    }\n\n}\n"]}