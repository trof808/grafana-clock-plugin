{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","panel","events","on","render","console","log","nodes","document","querySelectorAll","length","remove","histData","items","renderHist","renderingCompleted","values","parseDate","d3","timeParse","forEach","d","x","margin","top","right","bottom","left","width","height","svg","select","append","attr","max","v","y","scaleOrdinal","domain","map","range","call","axisBottom","tickFormat","timeFormat","scaleLinear","data","histogram","value","thresholds","ticks","timeDay","axisLeft","selectAll","enter","style","rangeBand","$","moment"],"mappings":"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","file":"rendering.js","sourcesContent":["import $ from 'jquery';\nimport * as d3 from \"d3\";\nimport moment from 'moment';\n\nexport default function link(scope, elem, attrs, ctrl) {\n    const panel = ctrl.panel;\n    ctrl.events.on('render', function () {\n        render();\n    });\n\n    function render() {\n        console.log(panel);\n        const nodes = document.querySelectorAll(\"panel-plugin-test-clock-plugin.panel-height-helper ng-transclude.panel-height-helper svg\");\n        if (nodes.length > 0) {\n            nodes[0].remove();\n        }\n        if (panel.histData.length > 0 && panel.histData[0].items.length > 0) {\n            renderHist();\n            ctrl.renderingCompleted();\n        }\n    }\n\n\n    function renderHist() {\n        const values = panel.histData[0].items;\n\n        var parseDate = d3.timeParse(\"%Y-%m-%d\");\n        values.forEach(function(d) {\n           d.x = parseDate(d.x);\n        });\n        console.log(values);\n\n        var margin = {top: 10, right: 30, bottom: 30, left: 40},\n            width = 460 - margin.left - margin.right,\n            height = 400 - margin.top - margin.bottom;\n\n        var svg = d3.select(\"panel-plugin-test-clock-plugin.panel-height-helper ng-transclude.panel-height-helper\").append(\"svg\")\n            .attr(\"width\", width + margin.left + margin.right)\n            .attr(\"height\", height + margin.top + margin.bottom)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n        var max = d3.max(values, function(v) { return v.y });\n\n        var x = d3.scaleOrdinal()\n            .domain(values.map(function(v) { return v.x }))\n            .range([margin.left, width - margin.right]);\n        svg.append(\"g\")\n            .attr(\"class\", \"x axis\")\n            .attr(\"transform\", \"translate(0,\" + height + \")\")\n            .call(d3.axisBottom(x).tickFormat(d3.timeFormat(\"%Y-%m-%d\")));\n\n        var y = d3.scaleLinear()\n            .domain([0, max])\n            .range([height, 0]);\n\n        var data = d3.histogram()\n            .value(function(d) { return d.x })\n            .domain(x.domain())\n            .thresholds(x.ticks(d3.timeDay))\n            (values);\n\n        svg.append(\"g\")\n            .attr(\"transform\", \"translate(35,0)\")\n            .call(d3.axisLeft(y));\n\n        console.log(data);\n        console.log(values);\n\n        // svg.selectAll(\"rect\")\n        //     .data(data)\n        //     .enter()\n        //     .append(\"rect\")\n        //     .attr(\"x\", 1)\n        //     .attr(\"transform\", function(d) { return \"translate(\" + x(d.x0) + \",\" + y(d[0] || 0) + \")\"; })\n        //     .attr(\"width\", function(d) { return x(d.x1) - x(d.x0) -1 ; })\n        //     .attr(\"height\", function(d) { return (height - y(d[0] || 0)); })\n        //     .style(\"fill\", \"#69b3a2\")\n\n        svg.selectAll(\"bar\")\n            .data(values)\n            .enter().append(\"rect\")\n            .style(\"fill\", \"steelblue\")\n            .attr(\"x\", function(d) { return x(d.x); })\n            .attr(\"width\", x.rangeBand())\n            .attr(\"y\", function(d) { return y(d.y); })\n            .attr(\"height\", function(d) { return height - y(d.y); });\n    }\n\n}\n"]}