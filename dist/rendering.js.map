{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","panel","events","on","render","console","log","renderHist","data","histData","xData","map","d","x","yData","y","margin","top","right","bottom","left","width","height","d3","scaleTime","domain","length","rangeRound","scaleLinear","range","histogram","value","format","thresholds","ticks","timeWeek","svg","select","append","attr","call","axisBottom","bins","max","bar","selectAll","enter","x0","x1","text","formatCount","type","date","parseDate","$"],"mappings":";;;;;;AAGe,aAASA,IAAT,CAAcC,KAAd,EAAqBC,IAArB,EAA2BC,KAA3B,EAAkCC,IAAlC,EAAwC;AACnD,YAAMC,QAAQD,KAAKC,KAAnB;;AAEAD,aAAKE,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,YAAY;AACjCC;AACH,SAFD;;AAIA,iBAASA,MAAT,GAAkB;AACdC,oBAAQC,GAAR,CAAYL,KAAZ;AACAM;AACH;;AAED,iBAASA,UAAT,GAAsB;AAClB,gBAAMC,OAAOP,MAAMQ,QAAN,CAAe,CAAf,CAAb;AACA,gBAAMC,QAAQF,KAAKG,GAAL,CAAS;AAAA,uBAAKC,EAAEC,CAAP;AAAA,aAAT,CAAd;AACA,gBAAMC,QAAQN,KAAKG,GAAL,CAAS;AAAA,uBAAKC,EAAEG,CAAP;AAAA,aAAT,CAAd;AACAV,oBAAQC,GAAR,CAAYI,KAAZ;AACAL,oBAAQC,GAAR,CAAYQ,KAAZ;AACA,gBAAIE,SAAS,EAACC,KAAK,EAAN,EAAUC,OAAO,EAAjB,EAAqBC,QAAQ,EAA7B,EAAiCC,MAAM,EAAvC,EAAb;AAAA,gBACIC,QAAQ,MAAML,OAAOI,IAAb,GAAoBJ,OAAOE,KADvC;AAAA,gBAEII,SAAS,MAAMN,OAAOC,GAAb,GAAmBD,OAAOG,MAFvC;;AAIA,gBAAIN,IAAIU,GAAGC,SAAH,GACHC,MADG,CACI,CAACf,MAAM,CAAN,CAAD,EAAWA,MAAMA,MAAMgB,MAAN,GAAe,CAArB,CAAX,CADJ,EAEHC,UAFG,CAEQ,CAAC,CAAD,EAAIN,KAAJ,CAFR,CAAR;AAGAhB,oBAAQC,GAAR,CAAYO,CAAZ;;AAEA,gBAAIE,IAAIQ,GAAGK,WAAH,GACHC,KADG,CACG,CAACP,MAAD,EAAS,CAAT,CADH,CAAR;;AAGA,gBAAIQ,YAAYP,GAAGO,SAAH,GACXC,KADW,CACL,UAASnB,CAAT,EAAY;AAAE,uBAAOA,EAAEoB,MAAF,CAAS,YAAT,CAAP;AAAgC,aADzC,EAEXP,MAFW,CAEJZ,EAAEY,MAAF,EAFI,EAGXQ,UAHW,CAGApB,EAAEqB,KAAF,CAAQX,GAAGY,QAAX,CAHA,CAAhB;;AAKA,gBAAIC,MAAMb,GAAGc,MAAH,CAAU,0CAAV,EAAsDC,MAAtD,CAA6D,KAA7D,EACLC,IADK,CACA,OADA,EACSlB,QAAQL,OAAOI,IAAf,GAAsBJ,OAAOE,KADtC,EAELqB,IAFK,CAEA,QAFA,EAEUjB,SAASN,OAAOC,GAAhB,GAAsBD,OAAOG,MAFvC,EAGLmB,MAHK,CAGE,GAHF,EAILC,IAJK,CAIA,WAJA,EAIa,eAAevB,OAAOI,IAAtB,GAA6B,GAA7B,GAAmCJ,OAAOC,GAA1C,GAAgD,GAJ7D,CAAV;;AAMAmB,gBAAIE,MAAJ,CAAW,GAAX,EACKC,IADL,CACU,OADV,EACmB,cADnB,EAEKA,IAFL,CAEU,WAFV,EAEuB,iBAAiBjB,MAAjB,GAA0B,GAFjD,EAGKkB,IAHL,CAGUjB,GAAGkB,UAAH,CAAc5B,CAAd,CAHV;;AAKA,gBAAI6B,OAAOZ,UAAUpB,KAAV,CAAX;;AAEAK,cAAEU,MAAF,CAAS,CAAC,CAAD,EAAIF,GAAGoB,GAAH,CAAOD,IAAP,EAAa5B,KAAb,CAAJ,CAAT;;AAEAT,oBAAQC,GAAR,CAAYoC,IAAZ;;AAEA,gBAAIE,MAAMR,IAAIS,SAAJ,CAAc,MAAd,EACLrC,IADK,CACAkC,IADA,EAELI,KAFK,GAEGR,MAFH,CAEU,GAFV,EAGLC,IAHK,CAGA,OAHA,EAGS,KAHT,EAILA,IAJK,CAIA,WAJA,EAIa,UAAS3B,CAAT,EAAY;AAAE,uBAAO,eAAeC,EAAED,EAAEmC,EAAJ,CAAf,GAAyB,GAAzB,GAA+BhC,EAAEH,EAAEc,MAAJ,CAA/B,GAA6C,GAApD;AAA0D,aAJrF,CAAV;;AAMAkB,gBAAIN,MAAJ,CAAW,MAAX,EACKC,IADL,CACU,GADV,EACe,CADf,EAEKA,IAFL,CAEU,OAFV,EAEmB,UAAS3B,CAAT,EAAY;AAAE,uBAAOC,EAAED,EAAEoC,EAAJ,IAAUnC,EAAED,EAAEmC,EAAJ,CAAV,GAAoB,CAA3B;AAA+B,aAFhE,EAGKR,IAHL,CAGU,QAHV,EAGoB,UAAS3B,CAAT,EAAY;AAAE,uBAAOU,SAASP,EAAEH,EAAEc,MAAJ,CAAhB;AAA8B,aAHhE;;AAKAkB,gBAAIN,MAAJ,CAAW,MAAX,EACKC,IADL,CACU,IADV,EACgB,OADhB,EAEKA,IAFL,CAEU,GAFV,EAEe,CAFf,EAGKA,IAHL,CAGU,GAHV,EAGe,UAAS3B,CAAT,EAAY;AAAE,uBAAO,CAACC,EAAED,EAAEoC,EAAJ,IAAUnC,EAAED,EAAEmC,EAAJ,CAAX,IAAsB,CAA7B;AAAiC,aAH9D,EAIKR,IAJL,CAIU,aAJV,EAIyB,QAJzB,EAKKU,IALL,CAKU,UAASrC,CAAT,EAAY;AAAE,uBAAOsC,YAAYtC,EAAEc,MAAd,CAAP;AAA+B,aALvD;;AAOA,qBAASyB,IAAT,CAAcvC,CAAd,EAAiB;AACbA,kBAAEwC,IAAF,GAASC,UAAUzC,EAAEwC,IAAZ,CAAT;AACA,uBAAOxC,CAAP;AACH;AACJ;AAEJ;;uBA5EuBhB,I;;;;AAHjB0D,a;;AACK/B,c","file":"rendering.js","sourcesContent":["import $ from 'jquery';\nimport * as d3 from \"d3\";\n\nexport default function link(scope, elem, attrs, ctrl) {\n    const panel = ctrl.panel;\n\n    ctrl.events.on('render', function () {\n        render();\n    });\n\n    function render() {\n        console.log(panel);\n        renderHist();\n    }\n\n    function renderHist() {\n        const data = panel.histData[0];\n        const xData = data.map(d => d.x);\n        const yData = data.map(d => d.y);\n        console.log(xData);\n        console.log(yData);\n        var margin = {top: 10, right: 30, bottom: 30, left: 30},\n            width = 960 - margin.left - margin.right,\n            height = 500 - margin.top - margin.bottom;\n\n        var x = d3.scaleTime()\n            .domain([xData[0], xData[xData.length - 1]])\n            .rangeRound([0, width]);\n        console.log(x);\n\n        var y = d3.scaleLinear()\n            .range([height, 0]);\n\n        var histogram = d3.histogram()\n            .value(function(d) { return d.format(\"DD-MM-YYYY\"); })\n            .domain(x.domain())\n            .thresholds(x.ticks(d3.timeWeek));\n\n        var svg = d3.select(\"div.panel-content > .panel-height-helper\").append(\"svg\")\n            .attr(\"width\", width + margin.left + margin.right)\n            .attr(\"height\", height + margin.top + margin.bottom)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n        svg.append(\"g\")\n            .attr(\"class\", \"axis axis--x\")\n            .attr(\"transform\", \"translate(0,\" + height + \")\")\n            .call(d3.axisBottom(x));\n\n        var bins = histogram(xData);\n\n        y.domain([0, d3.max(bins, yData)]);\n\n        console.log(bins);\n\n        var bar = svg.selectAll(\".bar\")\n            .data(bins)\n            .enter().append(\"g\")\n            .attr(\"class\", \"bar\")\n            .attr(\"transform\", function(d) { return \"translate(\" + x(d.x0) + \",\" + y(d.length) + \")\"; });\n\n        bar.append(\"rect\")\n            .attr(\"x\", 1)\n            .attr(\"width\", function(d) { return x(d.x1) - x(d.x0) - 1; })\n            .attr(\"height\", function(d) { return height - y(d.length); });\n\n        bar.append(\"text\")\n            .attr(\"dy\", \".75em\")\n            .attr(\"y\", 6)\n            .attr(\"x\", function(d) { return (x(d.x1) - x(d.x0)) / 2; })\n            .attr(\"text-anchor\", \"middle\")\n            .text(function(d) { return formatCount(d.length); });\n\n        function type(d) {\n            d.date = parseDate(d.date);\n            return d;\n        }\n    }\n\n}\n"]}